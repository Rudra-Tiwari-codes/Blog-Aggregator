
> blog-aggregator@3.0.0 test
> jest --coverage

node.exe : PASS tests
/unit/validation.test
.js
At line:1 char:1
+ & "C:\Program Files
\nodejs/node.exe" 
"C:\Program 
Files\nodejs/node_mo 
...
+ ~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~
    + CategoryInfo   
           : NotSpe  
  cified: (PASS te   
 sts/unit/validat    
ion.test.js:Stri    
ng) [], RemoteEx    
ception
    + FullyQualified 
   ErrorId : Native  
  CommandError
 
  Validation 
Middleware
    
validatePostsQuery
      ΓêÜ should be 
an array of 
validation 
middleware (11 ms)
    
validateSearchQuery
      ΓêÜ should be 
an array of 
validation middleware
    checkValidation
      ΓêÜ should 
call next() if no 
validation errors (2 
ms)
      ΓêÜ should 
throw 
ValidationError if 
validation errors 
exist (20 ms)

PASS tests/unit/secur
ity.test.js
  Security Middleware
    Rate Limiters
      ΓêÜ should 
have general limiter 
configured (11 ms)
      ΓêÜ should 
have API limiter 
configured (1 ms)
      ΓêÜ should 
have search limiter 
configured
    Helmet 
Configuration
      ΓêÜ should 
have helmet 
middleware configured
    CORS 
Configuration
      ΓêÜ should 
return CORS 
configuration object 
(3 ms)
      ΓêÜ should 
allow configured 
origins in 
development (2 ms)
      ΓêÜ should 
allow production 
origin (1 ms)
      ΓêÜ should 
allow requests with 
no origin (1 ms)
      ΓêÜ should 
reject unknown 
origins (1 ms)
      ΓêÜ should 
include correct HTTP 
methods (7 ms)
      ΓêÜ should 
enable credentials 
(6 ms)

PASS tests/unit/error
Handler.test.js
  Error Handler 
Middleware
    errorHandler
      ΓêÜ should 
handle AppError 
correctly (23 ms)
      ΓêÜ should 
handle 
ValidationError
      ΓêÜ should 
handle CastError (1 
ms)
      ΓêÜ should 
handle unknown 
errors with 500 (1 
ms)
      ΓêÜ should 
include stack trace 
in development (2 ms)
      ΓêÜ should not 
include stack trace 
in production (1 ms)
    notFoundHandler
      ΓêÜ should 
return 404 status
      ΓêÜ should 
return error JSON 
response (1 ms)
      ΓêÜ should log 
warning (1 ms)
    asyncHandler
      ΓêÜ should 
call the wrapped 
function (1 ms)
      ΓêÜ should 
catch errors and 
pass to next
      ΓêÜ should 
handle synchronous 
errors (1 ms)

2025-12-19 15:09:25:925 [32minfo[39m: [32mDeduplicated 2 posts to 1 unique posts[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mDeduplicated 2 posts to 2 unique posts[39m
PASS tests/unit/utils
.test.js
  Utility Functions
    Constants
      ΓêÜ 
CACHE_DURATION_MS 
should be 30 minutes 
(5 ms)
      ΓêÜ HTTP 
status codes should 
be correct
    URL Normalization
      ΓêÜ should 
remove trailing slash
      ΓêÜ should 
convert to lowercase 
(1 ms)
      ΓêÜ should 
handle invalid URLs
      ΓêÜ should 
handle 
null/undefined (1 ms)
    Post 
Deduplication
      ΓêÜ should 
remove duplicate 
posts by URL (3 ms)
      ΓêÜ should 
keep posts with 
different URLs (1 ms)

FAIL tests/unit/posts
Service.test.js
  Posts Service
    loadFromFile
      ΓêÜ should 
load posts from 
cache file (13 ms)
    saveToFile
      ΓêÜ should 
save posts to cache 
file (1 ms)
      ΓêÜ should not 
save on Vercel 
platform (1 ms)
    fetchAllPosts
      ΓêÜ should 
fetch and merge 
posts from both 
sources (1 ms)
      ΓêÜ should 
continue if one 
source fails
      ΓêÜ should 
deduplicate posts (1 
ms)
    getPosts
      ├ù should 
return cached posts 
if cache is fresh (1 
ms)
      ΓêÜ should 
fetch fresh posts 
when forced refresh 
(1 ms)

  ΓùÅ Posts Service 
ΓÇ║ getPosts ΓÇ║ 
should return cached 
posts if cache is 
fresh

    expect(jest.fn())
.not.toHaveBeenCalled
()

    Expected number 
of calls: 0
    Received number 
of calls: 1

    1: called with 0 
arguments

    [0m [90m 166 
|[39m
     [90m 167 
|[39m       expect(p
osts)[33m.[39mtoEqu
al(mockPosts)[33m;[
39m
    [31m[1m>[22m[
39m[90m 168 |[39m  
     expect(fetchBlog
gerPosts)[33m.[39mn
ot[33m.[39mtoHaveBe
enCalled()[33m;[39m
     [90m     
|[39m               
                     
 [31m[1m^[22m[39m
     [90m 169 
|[39m     
})[33m;[39m
     [90m 170 |[39m
     [90m 171 
|[39m     
it([32m'should 
fetch fresh posts 
when forced refresh'
[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at Object.toHav
eBeenCalled (tests/un
it/postsService.test.
js:168:37)

PASS tests/integratio
n/api.posts.test.js
  GET /api/posts
    ΓêÜ should 
return posts 
successfully (39 ms)
    ΓêÜ should force 
refresh when query 
param is true (7 ms)
    ΓêÜ should use 
cache by default (4 
ms)
    ΓêÜ should 
handle errors 
gracefully (6 ms)
    ΓêÜ should set 
cache control 
headers (8 ms)

PASS tests/integratio
n/api.search.test.js
  POST /api/search
    ΓêÜ should 
return search 
results successfully 
(60 ms)
    ΓêÜ should 
reject empty query 
(6 ms)
    ΓêÜ should 
reject missing query 
(7 ms)
    ΓêÜ should 
handle search with 
no results (5 ms)
    ΓêÜ should 
handle service 
errors gracefully (5 
ms)
    ΓêÜ should trim 
whitespace from 
query (4 ms)
    ΓêÜ should 
respect query length 
limits (4 ms)

2025-12-19 15:09:25:925 [32minfo[39m: [32mFetching posts (cached)[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mLoaded 10 posts from file cache[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mCache is stale, triggering background refresh...[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mStarting to fetch posts from all sources...[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mFetching Blogspot posts...[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mGET /api/posts 200 22ms[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mFetching posts (force refresh)[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mStarting to fetch posts from all sources...[39m
2025-12-19 15:09:25:925 [32minfo[39m: [32mFetching Blogspot posts...[39m
2025-12-19 15:09:27:927 [32minfo[39m: [32mFetched 10 Blogspot posts[39m
2025-12-19 15:09:27:927 [32minfo[39m: [32mFetching Medium posts for @testuser...[39m
2025-12-19 15:09:27:927 [32minfo[39m: [32mFetched 10 Blogspot posts[39m
2025-12-19 15:09:27:927 [32minfo[39m: [32mFetching Medium posts for @testuser...[39m
2025-12-19 15:09:27:927 [33mwarn[39m: [33mRetry attempt 1/3 after 1000ms[39m
2025-12-19 15:09:27:927 [33mwarn[39m: [33mRetry attempt 1/3 after 1000ms[39m
2025-12-19 15:09:28:928 [33mwarn[39m: [33mRetry attempt 2/3 after 2000ms[39m
2025-12-19 15:09:28:928 [33mwarn[39m: [33mRetry attempt 2/3 after 2000ms[39m
2025-12-19 15:09:31:931 [31merror[39m: [31mError fetching Medium posts: Medium RSS error: 404[39m
2025-12-19 15:09:31:931 [31merror[39m: [31mError fetching Medium posts: Failed to fetch Medium posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mDeduplicated 10 posts to 10 unique posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mLoaded 10 posts from file cache[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSaved 10 posts to cache file[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSuccessfully processed 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mBackground refresh completed[39m
2025-12-19 15:09:31:931 [31merror[39m: [31mError fetching Medium posts: Medium RSS error: 404[39m
2025-12-19 15:09:31:931 [31merror[39m: [31mError fetching Medium posts: Failed to fetch Medium posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mDeduplicated 10 posts to 10 unique posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mLoaded 10 posts from file cache[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSaved 10 posts to cache file[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSuccessfully processed 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mGET /api/posts?refresh=true 200 5339ms[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mPOST /api/search 400 1ms[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSearch request for: "javascript"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mReturning 10 posts from in-memory cache[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mStarting search for: "javascript" across 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mGemini AI initialized successfully[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mNo embedding generated, using text search fallback[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mText search for: "javascript" across 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mFound 0 matching posts for query: "javascript"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSearch found 0 results for "javascript"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mPOST /api/search 200 1ms[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSearch request for: "<script>alert("xss")</script>"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mReturning 10 posts from in-memory cache[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mStarting search for: "<script>alert("xss")</script>" across 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mNo embedding generated, using text search fallback[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mText search for: "<script>alert("xss")</script>" across 10 posts[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mFound 0 matching posts for query: "<script>alert("xss")</script>"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mSearch found 0 results for "<script>alert("xss")</script>"[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mPOST /api/search 200 1ms[39m
2025-12-19 15:09:31:931 [32minfo[39m: [32mGET /health 200 0ms[39m
PASS tests/integratio
n/api.test.js (7.869 
s)
  API Integration 
Tests
    GET /api/posts
      ΓêÜ should 
return posts array 
(61 ms)
      ΓêÜ should 
accept refresh query 
parameter (5345 ms)
    POST /api/search
      ΓêÜ should 
require query 
parameter (13 ms)
      ΓêÜ should 
search posts with 
valid query (5 ms)
      ΓêÜ should 
sanitize malicious 
input (4 ms)
    GET /health
      ΓêÜ should 
return health status 
(4 ms)

------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------
File              | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                
------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------
All files         |   73.34 |     54.2 |   69.84 |    73.2 |                                                                                                                  
 api              |   93.47 |       75 |     100 |   93.18 |                                                                                                                  
  posts.js        |     100 |       75 |     100 |     100 | 10                                                                                                               
  search.js       |   89.65 |       75 |     100 |   89.28 | 13,32,51                                                                                                         
 backend          |   67.37 |    48.27 |   64.28 |   67.38 |                                                                                                                  
  constants.js    |     100 |      100 |     100 |     100 |                                                                                                                  
  postsService.js |    91.2 |    72.97 |   88.88 |   91.01 | 31,95,121-122,129-131,180                                                                                        
  utils.js        |   57.08 |     41.6 |   57.57 |    57.2 | 57,97-98,125-154,167,192-193,198-199,204-205,210-211,259-265,270-367,434-452,472-494,509,521-522,556,562,571,579 
 middleware       |   96.77 |     92.3 |     100 |   96.66 |                                                                                                                  
  errorHandler.js |   94.11 |     87.5 |     100 |   93.93 | 30,77                                                                                                            
  security.js     |     100 |      100 |     100 |     100 |                                                                                                                  
  validation.js   |     100 |      100 |     100 |     100 |                                                                                                                  
 utils            |   64.44 |    33.33 |   55.55 |   64.44 |                                                                                                                  
  errors.js       |   63.63 |     12.5 |   42.85 |   63.63 | 32-63                                                                                                            
  logger.js       |   65.21 |       50 |     100 |   65.21 | 46-61                                                                                                            
------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------
Jest: "global" 
coverage threshold 
for branches (70%) 
not met: 54.2%
Jest: "global" 
coverage threshold 
for functions (70%) 
not met: 69.84%
Test Suites: 1 
failed, 7 passed, 8 
total
Tests:       1 
failed, 60 passed, 
61 total
Snapshots:   0 total
Time:        8.644 s
Ran all test suites.
